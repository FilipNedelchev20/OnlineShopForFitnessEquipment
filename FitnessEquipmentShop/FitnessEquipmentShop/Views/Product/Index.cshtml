@model IEnumerable<FitnessEquipmentShop.Data.Models.Entities.Product>

@{
    ViewData["Title"] = "Products";
}

<section class="container mt-5">
    <h2 class="text-center mb-4 fw-bold text-warning shadow-lg p-2 rounded-3">All Products 🛍️</h2>

    <div aria-live="polite" aria-atomic="true" class="position-relative">
        <div id="successToast" class="toast position-fixed top-0 end-0 m-3 bg-success text-white"
             role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">
            <div class="toast-header">
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">Product deleted successfully!</div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        @foreach (var product in Model)
        {
            <div class="col">
                <div class="card shadow-lg border-0 rounded-3" style="height: 450px;">
                    <div class="position-relative">
                        <img src="@product.ImageUrl" class="card-img-top img-fluid rounded-3" alt="@product.Name"
                             style="height: 250px; object-fit: cover; border-radius: 15px 15px 0 0;">
                        <span class="badge bg-primary position-absolute top-0 start-0 m-3 fw-bold animate__animated animate__fadeInLeft">✨ New</span>
                    </div>
                    <div class="card-body p-4 d-flex flex-column justify-content-between">
                        <h5 class="product-name text-dark fw-bold" style="font-size: 1.25rem; text-transform: uppercase;">@product.Name</h5>

                        <p class="product-price fw-bold text-success" style="font-size: 1.125rem;">$@product.Price</p>

                        <div class="d-flex gap-2">
                            <a href="@Url.Action("Details", "Product", new { id = product.Id })"
                               class="btn btn-outline-warning btn-sm shadow-lg fw-bold animate__animated animate__pulse animate__infinite">Details 👀</a>
                            <a href="@Url.Action("Add", "Cart", new { productId = product.Id })"
                               class="btn btn-success btn-sm shadow-lg fw-bold">Add to Cart 🛒</a>
                        </div>

                        @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
                        {
                            <div class="mt-2 d-flex gap-2">
                                <a href="@Url.Action("Edit", "Product", new { id = product.Id })" class="btn btn-warning btn-sm shadow-lg fw-bold">Edit ✏️</a>
                                <button class="btn btn-danger btn-sm shadow-lg fw-bold" data-bs-toggle="modal" data-bs-target="#deleteModal-@product.Id">
                                    Delete 🗑️
                                </button>
                            </div>

                            <!-- Delete Confirmation Modal -->
                            <div class="modal fade" id="deleteModal-@product.Id" tabindex="-1" aria-labelledby="deleteModalLabel-@product.Id" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Confirm Delete</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            Are you sure you want to delete <strong>@product.Name</strong>?
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <form method="post" action="@Url.Action("Delete", "Product", new { id = product.Id })">
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="btn btn-danger">Delete</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function () {
            var successMessage = '@TempData["SuccessMessage"]';
            if (successMessage) {
                var toastEl = $('#successToast');
                toastEl.find('.toast-body').text(successMessage);
                toastEl.toast('show');
            }
        });
    </script>
}
